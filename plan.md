# RAT (Rust Agent Terminal)
## High-Performance ACP Client for Claude Code & Gemini

### Executive Summary

RAT is a high-performance terminal-based ACP (Agent Client Protocol) client written in Rust, leveraging tachyonfx for stunning visual effects. The project creates a unified interface for interacting with multiple AI coding agents (Claude Code and Gemini CLI) through a standardized protocol, providing a superior alternative to traditional terminal interactions with rich visual feedback, structured edit reviews, and **multi-agent control capabilities**. 

RAT enables developers to manage and control multiple agents simultaneously - switching between different agents for different tasks, running parallel sessions, and maintaining multiple concurrent conversations with different AI models.

### Project Architecture

#### Core Components

1. **ACP Client Core** (`src/acp/`)
   - **Client Implementation**: Rust-based ACP client using `agent-client-protocol` crate
   - **Session Management**: Multi-session support with concurrent agent connections
   - **Message Routing**: JSON-RPC 2.0 bidirectional communication handling
   - **Permission System**: Interactive permission prompts for file operations and tool calls

2. **Agent Adapters** (`src/adapters/`)
   - **Claude Code Adapter**: Integration with `@anthropic-ai/claude-code` SDK via subprocess
   - **Gemini Adapter**: Direct integration with Gemini CLI as ACP agent
   - **Unified Interface**: Common adapter trait for seamless agent switching
   - **Multi-Agent Manager**: Control multiple agent instances simultaneously
   - **Health Monitoring**: Agent availability and capability detection

3. **TUI Framework** (`src/ui/`)
   - **Main Interface**: Tabbed layout supporting multiple concurrent agent sessions
   - **Agent Selector**: Quick switching between active agents with visual indicators
   - **Chat View**: Message threading with agent identification and syntax highlighting
   - **Edit Review**: Diff viewer with hunk-level accept/reject using tachyonfx transitions
   - **Terminal Integration**: Embedded terminal sessions with streaming output
   - **Multi-Agent Dashboard**: Overview of all active agents and their current tasks
   - **Status Bar**: Real-time multi-agent status, session info, and progress indicators

4. **Effects System** (`src/effects/`)
   - **Message Animations**: Typewriter effects for AI responses
   - **Code Highlighting**: Syntax-aware color transitions for code blocks
   - **Edit Transitions**: Smooth diff animations with fade/slide effects
   - **Status Indicators**: Pulsing connection status and activity indicators
   - **Theme System**: Dynamic color schemes with smooth transitions

5. **Configuration** (`src/config/`)
   - **Agent Settings**: API keys, model preferences, timeout configurations
   - **UI Preferences**: Themes, keybindings, layout preferences
   - **Project Context**: Per-project agent preferences and custom instructions

### Technical Specifications

#### Dependencies
```toml
[dependencies]
agent-client-protocol = "0.2.0-alpha.6"
tachyonfx = "0.18.0"
ratatui = "0.29.0"
tokio = { version = "1.0", features = ["full"] }
serde = { version = "1.0", features = ["derive"] }
clap = { version = "4.5", features = ["derive"] }
anyhow = "1.0"
uuid = "1.11"
crossterm = "0.29"
```

#### Key Features

1. **Multi-Agent Control**
   - Simultaneous control of multiple Claude Code and Gemini agent instances
   - Tabbed interface for managing concurrent agent sessions
   - Quick agent switching with session preservation
   - Per-agent configuration and state management
   - Parallel task execution across different agents

2. **Rich Visual Experience**
   - Animated code diffs with tachyonfx effects
   - Smooth transitions between UI states
   - Syntax-highlighted code blocks with color animations
   - Real-time typing indicators and status updates

3. **Advanced Edit Management**
   - Structured edit review with diff visualization
   - Hunk-level accept/reject with animated feedback
   - Undo/redo support for edit operations
   - Batch edit operations with progress visualization

4. **Terminal Integration**
   - Embedded terminal sessions for agent tool execution
   - Streaming output with syntax highlighting
   - Interactive shell access with permission gating
   - Background process management

5. **Performance Optimizations**
   - Lazy loading of UI components
   - Efficient buffer management for large files
   - Streaming message processing
   - Minimal memory footprint

### Implementation Phases

#### Phase 1: Core Infrastructure (Weeks 1-2) - ‚úÖ MOSTLY COMPLETE
- [ ] **Basic ACP client implementation using `agent-client-protocol`** - ‚ö†Ô∏è NEEDS COMPLETION (client has dummy implementations)
- [x] **Message serialization/deserialization** - ‚úÖ COMPLETED
- [ ] **Session management and connection handling** - ‚ö†Ô∏è PARTIAL (structure exists, needs real ACP integration)
- [x] **Basic TUI shell with ratatui** - ‚úÖ COMPLETED (tabbed interface, keybindings, welcome screen)
- [x] **Configuration system with TOML support** - ‚úÖ COMPLETED

#### Phase 2: Claude Code Integration (Weeks 3-4) - ‚ö†Ô∏è IN PROGRESS
- [ ] **Claude Code subprocess adapter** - ‚ö†Ô∏è PARTIAL (structure exists, needs implementation)
- [ ] **Permission system for file operations** - ‚ö†Ô∏è PARTIAL (basic structure, needs real ACP integration)
- [ ] **Basic edit review interface** - ‚ùå NOT STARTED (UI structure exists but diff logic missing)
- [ ] **Terminal session embedding** - ‚ùå NOT STARTED
- [x] **Error handling and recovery** - ‚úÖ MOSTLY COMPLETE (basic error handling in place)

#### Phase 3: Gemini Integration (Weeks 5-6) - ‚ö†Ô∏è IN PROGRESS  
- [ ] **Gemini CLI integration as ACP agent** - ‚ö†Ô∏è PARTIAL (structure exists, needs implementation)
- [x] **Unified agent interface abstraction** - ‚úÖ COMPLETED (AgentAdapter trait implemented)
- [x] **Agent switching and session management** - ‚úÖ MOSTLY COMPLETE (AgentManager handles multiple agents)
- [ ] **MCP server pass-through support** - ‚ùå NOT STARTED
- [ ] **Model selection and configuration** - ‚ö†Ô∏è PARTIAL (config structure exists)

#### Phase 4: Visual Enhancement (Weeks 7-8) - ‚ùå EARLY STAGE
- [ ] **Tachyonfx integration for UI animations** - ‚ö†Ô∏è DEPENDENCY ADDED (effects modules exist but mostly empty)
- [ ] **Code diff visualization with effects** - ‚ùå NOT STARTED
- [ ] **Syntax highlighting with color transitions** - ‚ö†Ô∏è PARTIAL (basic structure exists)  
- [ ] **Theme system implementation** - ‚ö†Ô∏è PARTIAL (config support added)
- [x] **Status indicators and progress bars** - ‚úÖ BASIC IMPLEMENTATION (status bar exists)

#### Phase 5: Advanced Features (Weeks 9-10) - ‚ùå EARLY STAGE
- [x] **Multi-session management** - ‚úÖ COMPLETED (tabbed sessions, session switching implemented)
- [x] **Project-specific configurations** - ‚úÖ COMPLETED (config system supports per-project settings)
- [x] **Keybinding customization** - ‚úÖ COMPLETED (config system with keybinding support)
- [ ] **Plugin system for custom effects** - ‚ùå NOT STARTED
- [ ] **Performance profiling and optimization** - ‚ùå NOT STARTED

#### Phase 6: Polish & Documentation (Weeks 11-12) - ‚ùå NOT STARTED
- [ ] **Comprehensive testing suite** - ‚ö†Ô∏è PARTIAL (basic test structure exists)
- [ ] **User documentation and tutorials** - ‚ùå NOT STARTED  
- [ ] **Installation and packaging** - ‚ùå NOT STARTED
- [ ] **Performance benchmarks** - ‚ùå NOT STARTED
- [ ] **Release preparation** - ‚ùå NOT STARTED

---

## CURRENT STATUS SUMMARY (Updated: December 2024)

### ‚úÖ **COMPLETED AREAS (~40% of project)**
- **Project Structure & Build System**: Full Rust project with proper dependencies
- **Configuration System**: TOML-based config with agent, UI, and project settings
- **Core Application Framework**: Event loop, async architecture, message passing
- **Basic TUI**: Tabbed interface, keybindings, status bar, welcome screen
- **Multi-Agent Architecture**: AgentManager, adapter pattern, session management
- **Multi-Session Support**: Concurrent sessions with tab switching

### ‚ö†Ô∏è **PARTIALLY COMPLETE AREAS (~30% of project)**
- **ACP Client Core**: Structure exists but needs real protocol implementation
- **Agent Adapters**: Framework in place, needs actual subprocess management
- **Permission System**: Basic structure, needs ACP integration
- **Effects System**: Dependencies added, modules exist but mostly empty
- **Message Routing**: Basic async messaging, needs ACP protocol integration

### ‚ùå **MISSING CRITICAL COMPONENTS (~30% of project)**
- **Real ACP Protocol Communication**: Currently using dummy implementations
- **Subprocess Management**: Agent processes not actually started/managed
- **Edit Review & Diff Visualization**: Core feature missing
- **Terminal Embedding**: No embedded terminal functionality
- **TachyonFX Visual Effects**: Minimal implementation
- **Testing & Documentation**: Comprehensive coverage missing

### üö® **IMMEDIATE PRIORITIES**
1. **Fix ACP Client Implementation** - Replace dummy implementations with real ACP protocol
2. **Implement Agent Subprocess Management** - Actually start and communicate with agents  
3. **Add Basic Edit Review** - Core diff viewing and approval workflow
4. **Test End-to-End Functionality** - Ensure agent communication works

The project has excellent architectural foundations but needs focused work on the core ACP functionality to become functional.

### File Structure
```
rat/
‚îú‚îÄ‚îÄ Cargo.toml
‚îú‚îÄ‚îÄ README.md
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ main.rs
‚îÇ   ‚îú‚îÄ‚îÄ app.rs                    # Main application state
‚îÇ   ‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ mod.rs
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ agent.rs             # Agent configurations
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ui.rs                # UI preferences
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ project.rs           # Project-specific settings
‚îÇ   ‚îú‚îÄ‚îÄ acp/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ mod.rs
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ client.rs            # ACP client implementation
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ session.rs           # Session management
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ message.rs           # Message handling
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ permissions.rs       # Permission system
‚îÇ   ‚îú‚îÄ‚îÄ adapters/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ mod.rs
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ claude_code.rs       # Claude Code adapter
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ gemini.rs            # Gemini CLI adapter
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ manager.rs           # Multi-agent instance manager
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ traits.rs            # Common adapter interfaces
‚îÇ   ‚îú‚îÄ‚îÄ ui/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ mod.rs
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ app.rs               # Main UI coordinator
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ chat.rs              # Chat interface
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ diff.rs              # Edit review interface
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ terminal.rs          # Terminal embedding
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ statusbar.rs         # Status bar
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ components/          # Reusable UI components
‚îÇ   ‚îú‚îÄ‚îÄ effects/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ mod.rs
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ text.rs              # Text animation effects
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ code.rs              # Code-specific effects
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ transitions.rs       # UI transition effects
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ themes.rs            # Theme and color effects
‚îÇ   ‚îî‚îÄ‚îÄ utils/
‚îÇ       ‚îú‚îÄ‚îÄ mod.rs
‚îÇ       ‚îú‚îÄ‚îÄ diff.rs              # Diff utilities
‚îÇ       ‚îú‚îÄ‚îÄ syntax.rs            # Syntax highlighting
‚îÇ       ‚îî‚îÄ‚îÄ terminal.rs          # Terminal utilities
‚îú‚îÄ‚îÄ examples/
‚îÇ   ‚îú‚îÄ‚îÄ basic_client.rs          # Simple ACP client example
‚îÇ   ‚îî‚îÄ‚îÄ effects_demo.rs          # Tachyonfx effects showcase
‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îú‚îÄ‚îÄ integration/
‚îÇ   ‚îî‚îÄ‚îÄ unit/
‚îî‚îÄ‚îÄ docs/
    ‚îú‚îÄ‚îÄ user_guide.md
    ‚îú‚îÄ‚îÄ configuration.md
    ‚îî‚îÄ‚îÄ development.md
```

### Technical Challenges & Solutions

1. **ACP Protocol Complexity**
   - **Challenge**: Managing bidirectional JSON-RPC with multiple concurrent sessions
   - **Solution**: Use `agent-client-protocol` crate with careful async state management

2. **Cross-Platform Agent Integration**
   - **Challenge**: Different agents have varying installation and execution patterns
   - **Solution**: Abstract agent management with capability detection and auto-installation

3. **Performance with Visual Effects**
   - **Challenge**: Maintaining 60fps with complex tachyonfx animations
   - **Solution**: Selective effect application, frame rate limiting, and effect LOD system

4. **Terminal Integration**
   - **Challenge**: Embedding interactive terminals within TUI
   - **Solution**: Use `portable-pty` with custom rendering and input routing

5. **Edit Review UX**
   - **Challenge**: Making diff review intuitive and efficient
   - **Solution**: Hunk-level navigation with clear visual feedback and batch operations

### Success Metrics

1. **Performance**: Sub-100ms response times for UI interactions
2. **Reliability**: 99%+ uptime for agent connections
3. **Usability**: Intuitive interface requiring minimal learning curve
4. **Extensibility**: Plugin system supporting custom agents and effects
5. **Adoption**: Positive community feedback and contribution activity

### Risk Mitigation

1. **Agent API Changes**: Version pinning with update notifications
2. **Platform Compatibility**: Extensive testing on major platforms
3. **Performance Issues**: Profiling throughout development with optimization sprints
4. **User Experience**: Regular user testing and feedback incorporation

### Future Enhancements

- **Multi-Language Support**: Internationalization for global usage
- **Cloud Sync**: Configuration and session synchronization
- **Collaborative Features**: Shared sessions and pair programming
- **AI Training Integration**: Custom model fine-tuning support
- **Extension Marketplace**: Community-driven plugins and themes

---

This project positions RAT as the premier terminal-based interface for AI coding agents, combining the performance of Rust with the visual appeal of modern UIs, setting a new standard for developer-AI interaction paradigms.